function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("core_reportbuilder/audience",["exports","core/templates","core/notification","core/pending","core/str","core_form/dynamicform","core/toast","core_reportbuilder/local/repository/audiences","core_reportbuilder/local/selectors","core/fragment","core_form/changechecker"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=n(b);c=n(c);d=n(d);f=n(f);i=m(i);function l(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;l=function(){return a};return a}function m(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=l();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function n(a){return a&&a.__esModule?a:{default:a}}function o(a,b){return t(a)||s(a,b)||q(a,b)||p()}function p(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function q(a,b){if(!a)return;if("string"==typeof a)return r(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return r(a,b)}function r(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function s(a,b){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(a)))return;var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function t(a){if(Array.isArray(a))return a}var u=0,v=0,w=function(a,f){var h=new d.default("core_reportbuilder/audience:add"),l=document.querySelector(i.regions.audiencesContainer),m=l.querySelectorAll(i.regions.audienceCard).length,n={classname:a,reportid:u,showormessage:0<m,title:f};(0,j.loadFragment)("core_reportbuilder","audience_form",v,n).then(function(a,c){var d=b.default.appendNodeContents(l,a,c)[0],g=l.querySelector(i.regions.audienceEmptyMessage),h=y(d);(0,k.markFormAsDirty)(h.getFormNode());g.classList.add("hidden");return(0,e.get_string)("audienceadded","core_reportbuilder",f)}).then(g.add).then(function(){return h.resolve()}).catch(c.default.exception)},x=function(a){var b=new d.default("core_reportbuilder/audience:edit"),e=y(a),f={reportid:u,id:a.dataset.instanceid,classname:a.dataset.classname};e.load(f).then(function(){var c=a.querySelector(i.regions.audienceFormContainer),d=a.querySelector(i.regions.audienceDescription),e=a.querySelector(i.actions.audienceEdit);c.classList.remove("hidden");d.classList.add("hidden");e.disabled=!0;return b.resolve()}).catch(c.default.exception)},y=function(a){var b=a.querySelector(i.regions.audienceFormContainer),c=new f.default(b,"\\core_reportbuilder\\form\\audience");c.addEventListener(c.events.FORM_SUBMITTED,function(b){var c=a.querySelector(i.regions.audienceDescription);a.dataset.instanceid=b.detail.instanceid;c.innerHTML=b.detail.description;A(a);return(0,e.get_string)("audiencesaved","core_reportbuilder").then(g.add)});c.addEventListener(c.events.FORM_CANCELLED,function(){if(0<a.dataset.instanceid){A(a)}else{B(a)}});return c},z=function(a){var b=a.dataset.title;(0,e.get_strings)([{key:"deleteaudience",component:"core_reportbuilder",param:b},{key:"deleteaudienceconfirm",component:"core_reportbuilder",param:b},{key:"delete",component:"moodle"}]).then(function(f){var i=o(f,3),j=i[0],k=i[1],l=i[2];c.default.confirm(j,k,l,null,function(){var f=new d.default("core_reportbuilder/audience:delete");(0,h.deleteAudience)(u,a.dataset.instanceid).then(function(){return(0,e.get_string)("audiencedeleted","core_reportbuilder",b)}).then(g.add).then(function(){B(a);return f.resolve()}).catch(c.default.exception)})}).catch(c.default.exception)},A=function(a){var b=a.querySelector(i.regions.audienceFormContainer),c=b.cloneNode(!1);a.querySelector(i.regions.audienceForm).replaceChild(c,b);a.querySelector(i.regions.audienceDescription).classList.remove("hidden");a.querySelector(i.actions.audienceEdit).disabled=!1;a.querySelector(i.actions.audienceDelete).disabled=!1},B=function(a){a.remove();var b=document.querySelector(i.regions.audiencesContainer),c=b.querySelectorAll(i.regions.audienceCard);if(0===c.length){var d=document.querySelector(i.regions.audienceEmptyMessage);d.classList.remove("hidden")}else{var e=c[0].querySelector(".audience-separator");null===e||void 0===e?void 0:e.remove()}},C=!1,D=function(a,b){u=a;v=b;if(C){return}document.addEventListener("click",function(a){var b=a.target.closest(i.actions.audienceAdd);if(b){a.preventDefault();w(b.dataset.uniqueIdentifier,b.dataset.name)}var c=a.target.closest(i.actions.audienceEdit);if(c){var e=c.closest(i.regions.audienceCard);a.preventDefault();x(e)}var d=a.target.closest(i.actions.audienceDelete);if(d){var f=d.closest(i.regions.audienceCard);a.preventDefault();z(f)}});C=!0};a.init=D});
//# sourceMappingURL=audience.min.js.map
